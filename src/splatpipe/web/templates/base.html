<!DOCTYPE html>
<html data-theme="dark" lang="en" style="overflow-y: scroll;">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}Splatpipe{% endblock %}</title>
    <link rel="icon" type="image/png" href="/static/SplatPipe_Logo.png">
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.14/dist/full.min.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/htmx.org@2.0.4"></script>
    <script src="https://unpkg.com/htmx-ext-sse@2.2.2/sse.js"></script>
    <script>
    // Apply saved theme immediately to prevent flash
    (function() {
        var saved = localStorage.getItem('splatpipe-theme') || 'dark';
        document.documentElement.setAttribute('data-theme', saved);
    })();
    </script>
</head>
<body class="min-h-screen bg-base-200" hx-ext="sse">
    <div class="navbar bg-base-100 shadow-lg">
        <div class="flex-1">
            <a href="/" class="btn btn-ghost gap-2 text-xl">
                <img src="/static/SplatPipe_Logo.png" alt="Splatpipe" class="h-8 w-8">
                <span class="font-bold">Splatpipe</span>
            </a>
        </div>
        <div class="flex-none gap-2">
            <!-- Theme toggle -->
            <label class="swap swap-rotate btn btn-ghost btn-circle btn-sm">
                <input type="checkbox" id="theme-toggle" onchange="toggleTheme()">
                <!-- Sun icon -->
                <svg class="swap-off h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
                </svg>
                <!-- Moon icon -->
                <svg class="swap-on h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
                </svg>
            </label>
            <ul class="menu menu-horizontal px-1 gap-1">
                <li><a href="/projects/" class="{% if request.url.path == '/' or request.url.path.startswith('/projects') %}active{% endif %}">Projects</a></li>
                <li><a href="/settings/" class="{% if request.url.path.startswith('/settings') %}active{% endif %}">Settings</a></li>
            </ul>
        </div>
    </div>

    <div class="container mx-auto px-4 py-8 max-w-6xl">
        {% block content %}{% endblock %}
    </div>

    <!-- Toast container -->
    <div id="toast-container" class="toast toast-end toast-top z-50"></div>

    <script>
    // Theme toggle
    function toggleTheme() {
        var next = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
        document.documentElement.setAttribute('data-theme', next);
        localStorage.setItem('splatpipe-theme', next);
    }
    // Sync checkbox state on load
    (function() {
        var isDark = (localStorage.getItem('splatpipe-theme') || 'dark') === 'dark';
        var cb = document.getElementById('theme-toggle');
        if (cb) cb.checked = isDark;
    })();

    // Listen for HX-Trigger "showToast" events from HTMX responses
    document.body.addEventListener("showToast", function(evt) {
        var msg = evt.detail.message || "Done";
        var level = evt.detail.level || "success";
        var container = document.getElementById("toast-container");
        var alert = document.createElement("div");
        alert.className = "alert alert-" + level + " shadow-lg";
        alert.innerHTML = "<span>" + msg + "</span>";
        container.appendChild(alert);
        setTimeout(function() {
            alert.style.transition = "opacity 0.3s";
            alert.style.opacity = "0";
            setTimeout(function() { alert.remove(); }, 300);
        }, 3000);
    });
    </script>
</body>
</html>
